import{r as T,a as nt,J as j,f as M,j as i,v as l,x as ot,y as t,K as at,E as f,I as c,F as _,G as y,C as I,A as g,B as w,O as it,P as lt,z as W}from"./vendor-a1a62974.js";import{d as k,a as dt}from"./index-912f96f0.js";import{p as rt,q as N,M as ct,x as U,O as F,P as ut,B as vt,N as mt}from"./firebase-1b009ed5.js";import{b as L,c as pt}from"./alert-015a1aea.js";import{F as _t}from"./FloatingIcons-e36b23d3.js";import{_ as yt}from"./_plugin-vue_export-helper-c27b6911.js";import"./sweetalert2.esm.all-9d2ad45a.js";const ft={class:"calendar-page"},bt={class:"container"},Dt={class:"calendar-controls mb-4"},ht={class:"is-flex is-justify-content-space-between is-align-items-center"},gt={class:"is-flex is-align-items-center gap-3"},wt={class:"view-toggle"},kt={class:"is-flex is-align-items-center gap-2"},St={class:"current-period"},xt={class:"calendar-view"},Et={key:0,class:"month-view"},Ct={class:"calendar-header"},Tt={class:"calendar-grid"},It=["onClick"],Ot={class:"day-number"},$t={class:"day-events"},Mt=["title"],Nt={key:0,class:"more-events"},Ut={class:"month-event-list"},Vt={class:"month-event-time"},Ht={class:"month-event-title"},Pt={key:1,class:"week-view"},jt={class:"week-header"},Wt={class:"day-header"},Ft={class:"day-date"},Lt={class:"week-grid"},At={class:"time-slots"},Bt={class:"week-events"},Kt={class:"event-time"},Jt={class:"event-title"},Gt=["onClick"],zt={key:2,class:"day-view"},Rt={class:"day-timeline"},qt={class:"hour-label"},Qt={class:"hour-events"},Yt={class:"event-time"},Xt={class:"event-content"},Zt={class:"event-title"},te={class:"event-description"},ee=["onClick"],se={class:"events-sidebar"},ne={class:"upcoming-events"},oe=["onClick"],ae={class:"event-time"},ie={class:"event-info"},le={class:"event-title"},de={class:"event-date"},re={class:"modal-card"},ce={class:"modal-card-head"},ue={class:"modal-card-title"},ve={class:"modal-card-body"},me={class:"field"},pe={class:"control"},_e={class:"field"},ye={class:"control"},fe={class:"columns"},be={class:"column is-6"},De={class:"field"},he={class:"control"},ge={class:"column is-6"},we={class:"field"},ke={class:"control"},Se={class:"columns"},xe={class:"column is-6"},Ee={class:"field"},Ce={class:"control"},Te={class:"select is-fullwidth"},Ie={class:"column is-6"},Oe={class:"field"},$e={class:"control"},Me={class:"field"},Ne={class:"control"},Ue={class:"modal-card-foot"},Ve={__name:"Calendar",setup(He){const h=T(!1),S=T(null),m=T("month"),v=T(new Date);function O(n){if(m.value!==n){if(n!=="month"){if(n==="week"){const e=C(v.value);v.value=new Date(e)}}m.value=n}}const d=nt({title:"",description:"",date:"",time:"",type:"personal",duration:60,location:""}),x=T([]),V=async(n,e)=>{const s=$();if(s&&!(!e||!e.id||!e.title||!e.date))try{let o="",r="",u="event_update";switch(n){case"two_days_before":o="Evento Próximo",r=`El evento "${e.title}" es en 2 días (${e.date})`,u="event_two_days_before";break;case"day_of":o="¡Evento Hoy!",r=`El evento "${e.title}" es hoy (${e.date})`,u="event_day_of";break;default:return}const a=(await vt(U(k,"users",s))).data(),p={toUserId:s,fromUserId:s,fromUserName:(a==null?void 0:a.name)||"Usuario",fromUserPhoto:(a==null?void 0:a.photo)||null,type:u,title:o,message:r,eventId:e.id,eventTitle:e.title,eventDate:e.date,eventTime:e.time||null,read:!1,createdAt:mt()};await F(N(k,"notifications"),p)}catch(o){console.error("Error enviando notificación de evento:",o)}},A=async n=>{if(!n||n.length===0)return;const e=new Date,s=new Date(e);s.setHours(0,0,0,0);const o=new Date(s);o.setDate(o.getDate()+2);const r=s.toDateString(),u=JSON.parse(localStorage.getItem(`eventNotifications_${r}`)||"{}");let b=!1;for(const a of n)if(a.date)try{const p=new Date(a.date);if(isNaN(p.getTime()))continue;if(p.setHours(0,0,0,0),p.getTime()===o.getTime()){const D=`two_days_before_${a.id}`;u[D]||(await V("two_days_before",a),u[D]=!0,b=!0)}if(p.getTime()===s.getTime()){const D=`day_of_${a.id}`;u[D]||(await V("day_of",a),u[D]=!0,b=!0)}}catch(p){console.error("Error procesando fecha de evento:",a.id,p)}b&&localStorage.setItem(`eventNotifications_${r}`,JSON.stringify(u))},$=()=>{var n;return(n=dt.currentUser)==null?void 0:n.uid};j(()=>{let n=0;const e=3e5;rt(N(k,"events"),s=>{const o=$();if(!o)return;const u=s.docs.map(a=>({id:a.id,...a.data()})).filter(a=>a.userId===o);x.value=u;const b=Date.now();u.length>0&&o&&b-n>e&&(n=b,A(u))})});const E=["Lun","Mar","Mié","Jue","Vie","Sáb","Dom"],B=M(()=>{if(m.value==="month")return v.value.toLocaleDateString("es-ES",{month:"long",year:"numeric"});if(m.value==="week"){const n=C(v.value),e=Y(v.value);return`${n.toLocaleDateString("es-ES",{day:"numeric",month:"short"})} - ${e.toLocaleDateString("es-ES",{day:"numeric",month:"short"})}`}else return v.value.toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long"})}),K=M(()=>{const n=v.value.getFullYear(),e=v.value.getMonth(),s=new Date(n,e,1);let o=new Date(s),r=s.getDay();r===0?o.setDate(o.getDate()-6):o.setDate(o.getDate()-(r-1));const u=[],b=new Date;for(let a=0;a<42;a++){const p=new Date(o);p.setDate(o.getDate()+a);const D=p.toISOString().split("T")[0],et=x.value.filter(st=>new Date(st.date+"T00:00:00").toISOString().split("T")[0]===D);u.push({date:D,dayNumber:p.getDate(),isCurrentMonth:p.getMonth()===e,isToday:p.toDateString()===b.toDateString(),events:et})}return u}),J=M(()=>{const n=new Date;return x.value.filter(e=>new Date(e.date)>=n).sort((e,s)=>new Date(e.date+" "+e.time)-new Date(s.date+" "+s.time)).slice(0,5)}),G=()=>{const n=new Date(v.value);m.value==="month"?n.setMonth(n.getMonth()-1):m.value==="week"?n.setDate(n.getDate()-7):n.setDate(n.getDate()-1),v.value=n},z=()=>{const n=new Date(v.value);m.value==="month"?n.setMonth(n.getMonth()+1):m.value==="week"?n.setDate(n.getDate()+7):n.setDate(n.getDate()+1),v.value=n},R=n=>{n.isCurrentMonth&&(m.value="day",v.value=new Date(n.date+"T00:00:00"))},q=n=>{S.value=n,Object.assign(d,n),h.value=!0},Q=async()=>{const n=$();n&&(!d.title.trim()||!d.date||!d.time||(S.value?await ct(U(k,"events",S.value.id),{...d,userId:n}):await F(N(k,"events"),{...d,userId:n}),h.value=!1,S.value=null,Object.assign(d,{title:"",description:"",date:"",time:"",type:"personal",duration:60,location:""}),L("creado exitosamente")))},H=async n=>{(await pt("¿deseas eliminar el evento?")).isConfirmed&&(L("eliminado exitosamente"),await ut(U(k,"events",n)))},C=n=>{const e=new Date(n),s=e.getDay(),o=e.getDate()-s+(s===0?-6:1);return new Date(e.setDate(o))},Y=n=>{const e=C(n);return e.setDate(e.getDate()+6),e},X=n=>{const e=E.indexOf(n),s=C(v.value);return s.setDate(s.getDate()+e),s.getDate()},Z=n=>{const e=E.indexOf(n),s=C(v.value);s.setDate(s.getDate()+e);const o=s.toISOString().split("T")[0];return x.value.filter(r=>new Date(r.date+"T00:00:00").toISOString().split("T")[0]===o)},tt=n=>{const e=v.value.toISOString().split("T")[0];return x.value.filter(s=>new Date(s.date+"T00:00:00").toISOString().split("T")[0]!==e?!1:parseInt(s.time.split(":")[0])===n)},P=n=>`${n.toString().padStart(2,"0")}:00`;return j(()=>{const n=new Date;d.date=n.toISOString().split("T")[0]}),(n,e)=>(i(),l("div",ft,[ot(_t,{viewType:"calendar"}),t("div",bt,[e[21]||(e[21]=t("div",{class:"page-header"},[t("h1",{class:"title is-2 text-primary"},"Calendario"),t("p",{class:"subtitle is-6 text-secondary"}," Gestiona tus eventos, reuniones y actividades ")],-1)),t("div",Dt,[t("div",ht,[t("div",gt,[t("button",{class:"btn btn-primary",onClick:e[0]||(e[0]=s=>h.value=!0)},e[14]||(e[14]=[t("i",{class:"bx bx-plus mr-2"},null,-1),at("Nuevo Evento ")])),t("div",wt,[t("button",{class:f(["btn btn-sm",m.value==="month"?"btn-primary":"btn-secondary"]),onClick:e[1]||(e[1]=s=>O("month"))}," Mes ",2),t("button",{class:f(["btn btn-sm",m.value==="week"?"btn-primary":"btn-secondary"]),onClick:e[2]||(e[2]=s=>O("week"))}," Semana ",2),t("button",{class:f(["btn btn-sm",m.value==="day"?"btn-primary":"btn-secondary"]),onClick:e[3]||(e[3]=s=>O("day"))}," Día ",2)])]),t("div",kt,[t("button",{class:"btn btn-sm btn-secondary",onClick:G},e[15]||(e[15]=[t("i",{class:"bx bx-chevron-left"},null,-1)])),t("span",St,c(B.value),1),t("button",{class:"btn btn-sm btn-secondary",onClick:z},e[16]||(e[16]=[t("i",{class:"bx bx-chevron-right"},null,-1)]))])])]),t("div",xt,[m.value==="month"?(i(),l("div",Et,[t("div",Ct,[(i(),l(_,null,y(E,s=>t("div",{class:"weekday",key:s},c(s),1)),64))]),t("div",Tt,[(i(!0),l(_,null,y(K.value,s=>(i(),l("div",{key:s.date,class:f(["calendar-day",{"other-month":!s.isCurrentMonth,today:s.isToday,"has-events":s.events.length>0}]),onClick:o=>R(s)},[t("div",Ot,c(s.dayNumber),1),t("div",$t,[(i(!0),l(_,null,y(s.events.slice(0,3),o=>(i(),l("div",{key:o.id,class:f(["event-dot","type-"+o.type]),title:o.title},null,10,Mt))),128)),s.events.length>3?(i(),l("div",Nt," +"+c(s.events.length-3)+" más ",1)):I("",!0)]),t("div",Ut,[(i(!0),l(_,null,y(s.events.slice(0,3),o=>(i(),l("div",{key:o.id,class:"month-event-item"},[t("span",Vt,c(o.time),1),t("span",Ht,c(o.title),1)]))),128))])],10,It))),128))])])):I("",!0),m.value==="week"?(i(),l("div",Pt,[t("div",jt,[e[17]||(e[17]=t("div",{class:"time-column"},null,-1)),(i(),l(_,null,y(E,s=>t("div",{key:s,class:"day-column"},[t("div",Wt,c(s),1),t("div",Ft,c(X(s)),1)])),64))]),t("div",Lt,[t("div",At,[(i(),l(_,null,y(24,s=>t("div",{key:s,class:"time-slot"},c(P(s)),1)),64))]),t("div",Bt,[(i(),l(_,null,y(E,s=>t("div",{key:s,class:"day-events-column"},[(i(),l(_,null,y(24,o=>t("div",{key:o,class:"week-hour-slot"},[(i(!0),l(_,null,y(Z(s).filter(r=>parseInt(r.time.split(":")[0])===o),r=>(i(),l("div",{key:r.id,class:f(["week-event","type-"+r.type])},[t("div",Kt,c(r.time),1),t("div",Jt,c(r.title),1),t("button",{class:"delete-event-btn",onClick:W(u=>H(r.id),["stop"])},e[18]||(e[18]=[t("i",{class:"bx bx-trash"},null,-1)]),8,Gt)],2))),128))])),64))])),64))])])])):I("",!0),m.value==="day"?(i(),l("div",zt,[t("div",Rt,[(i(),l(_,null,y(24,s=>t("div",{key:s,class:"timeline-hour"},[t("div",qt,c(P(s)),1),t("div",Qt,[(i(!0),l(_,null,y(tt(s),o=>(i(),l("div",{key:o.id,class:f(["timeline-event","type-"+o.type])},[t("div",Yt,c(o.time),1),t("div",Xt,[t("div",Zt,c(o.title),1),t("div",te,c(o.description),1)]),t("button",{class:"delete-event-btn",onClick:W(r=>H(o.id),["stop"])},e[19]||(e[19]=[t("i",{class:"bx bx-trash"},null,-1)]),8,ee)],2))),128))])])),64))])])):I("",!0)]),t("div",se,[e[20]||(e[20]=t("h3",{class:"title is-5 mb-3"},"Próximos Eventos",-1)),t("div",ne,[(i(!0),l(_,null,y(J.value,s=>(i(),l("div",{key:s.id,class:f(["event-card","type-"+s.type]),onClick:o=>q(s)},[t("div",ae,c(s.time),1),t("div",ie,[t("div",le,c(s.title),1),t("div",de,c(s.date),1)]),t("div",{class:f(["event-type-badge","type-"+s.type])},c(s.type),3)],10,oe))),128))])])]),t("div",{class:f(["modal",{"is-active":h.value}])},[t("div",{class:"modal-background",onClick:e[4]||(e[4]=s=>h.value=!1)}),t("div",re,[t("header",ce,[t("p",ue,c(S.value?"Editar Evento":"Nuevo Evento"),1),t("button",{class:"delete",onClick:e[5]||(e[5]=s=>h.value=!1)})]),t("section",ve,[t("div",me,[e[22]||(e[22]=t("label",{class:"label"},"Título",-1)),t("div",pe,[g(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>d.title=s),class:"input",type:"text",placeholder:"Título del evento"},null,512),[[w,d.title]])])]),t("div",_e,[e[23]||(e[23]=t("label",{class:"label"},"Descripción",-1)),t("div",ye,[g(t("textarea",{"onUpdate:modelValue":e[7]||(e[7]=s=>d.description=s),class:"textarea",placeholder:"Descripción del evento"},null,512),[[w,d.description]])])]),t("div",fe,[t("div",be,[t("div",De,[e[24]||(e[24]=t("label",{class:"label"},"Fecha",-1)),t("div",he,[g(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>d.date=s),class:"input",type:"date"},null,512),[[w,d.date]])])])]),t("div",ge,[t("div",we,[e[25]||(e[25]=t("label",{class:"label"},"Hora",-1)),t("div",ke,[g(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>d.time=s),class:"input",type:"time"},null,512),[[w,d.time]])])])])]),t("div",Se,[t("div",xe,[t("div",Ee,[e[27]||(e[27]=t("label",{class:"label"},"Tipo",-1)),t("div",Ce,[t("div",Te,[g(t("select",{"onUpdate:modelValue":e[10]||(e[10]=s=>d.type=s)},e[26]||(e[26]=[lt('<option value="trabajo" data-v-93ab5cde>Trabajo</option><option value="personal" data-v-93ab5cde>Personal</option><option value="salud" data-v-93ab5cde>Salud</option><option value="social" data-v-93ab5cde>Social</option><option value="ejercicio" data-v-93ab5cde>Ejercicio</option><option value="reunion" data-v-93ab5cde>Reunión</option>',6)]),512),[[it,d.type]])])])])]),t("div",Ie,[t("div",Oe,[e[28]||(e[28]=t("label",{class:"label"},"Duración (minutos)",-1)),t("div",$e,[g(t("input",{"onUpdate:modelValue":e[11]||(e[11]=s=>d.duration=s),class:"input",type:"number",min:"15",step:"15"},null,512),[[w,d.duration]])])])])]),t("div",Me,[e[29]||(e[29]=t("label",{class:"label"},"Ubicación",-1)),t("div",Ne,[g(t("input",{"onUpdate:modelValue":e[12]||(e[12]=s=>d.location=s),class:"input",type:"text",placeholder:"Ubicación (opcional)"},null,512),[[w,d.location]])])])]),t("footer",Ue,[t("button",{class:"btn btn-primary",onClick:Q},"Guardar"),t("button",{class:"button is-danger has-text-white-bis",onClick:e[13]||(e[13]=s=>h.value=!1)}," Cancelar ")])])],2)]))}},Je=yt(Ve,[["__scopeId","data-v-93ab5cde"]]);export{Je as default};

import{N as G,a as N,r as x,J as Y,w as z,j as c,v as m,y as t,A as b,B as _,C as y,I as k,z as Q,K as q}from"./vendor-a1a62974.js";import{a as r,d as l}from"./index-912f96f0.js";import{B as C,x as I,H as w,q as f,J as d,K as S,O as A,N as B,M as j}from"./firebase-1b009ed5.js";import{S as U}from"./sweetalert2.esm.all-9d2ad45a.js";/* empty css                                                                */import{_ as J}from"./_plugin-vue_export-helper-c27b6911.js";const L={class:"section profile-section"},H={class:"container"},W={class:"columns is-centered"},X={class:"column is-10-tablet is-8-desktop is-7-widescreen"},Z={class:"box profile-box"},ee={class:"has-text-centered mb-5"},te={class:"profile-photo-wrapper mb-2"},se=["src","alt"],oe={class:"mt-3"},ie={class:"title is-3 mb-1"},ae={class:"columns is-variable is-2 is-multiline profile-form-row"},ne={class:"column is-6"},re={class:"field"},le={class:"control"},de=["disabled"],ue={class:"column is-6"},ce={class:"field"},me={class:"control"},pe=["disabled"],fe={class:"column is-12"},he={class:"field"},ve={class:"control"},be=["disabled"],_e={class:"help is-pulled-right"},Ue={class:"buttons is-centered mt-5"},ge={key:1,type:"submit",class:"button is-success is-medium"},xe={__name:"Profile",setup(ye){const p=G(),o=N({name:"",email:"",bio:"",photo:"",uid:""}),s=N({name:"",email:"",bio:"",photo:""}),n=x(!1),g=x(!0),P=x("");async function D(){var a,h;const i=p.params.uid||((a=r.currentUser)==null?void 0:a.uid);if(!i)return;P.value=(h=r.currentUser)==null?void 0:h.uid,g.value=i===P.value;const e=await C(I(l,"users",i));if(e.exists()){const u=e.data();o.name=u.name||"",o.email=u.email||"",o.bio=u.bio||"",o.photo=u.photo||"",o.uid=i,s.name=o.name,s.email=o.email,s.bio=o.bio,s.photo=o.photo}n.value=!1}Y(()=>{const i=r.onAuthStateChanged(e=>{e&&D(),i()})}),z(()=>p.params.uid,D);async function R(){if(!g.value)return;const i=r.currentUser;i&&(await j(I(l,"users",i.uid),{name:s.name,email:s.email,bio:s.bio,photo:s.photo}),o.name=s.name,o.email=s.email,o.bio=s.bio,o.photo=s.photo,n.value=!1)}function O(){s.name=o.name,s.email=o.email,s.bio=o.bio,s.photo=o.photo,n.value=!1}function V(i){i.target.src=`https://ui-avatars.com/api/?name=${encodeURIComponent(o.name||"U")}&size=150`}function T(){}function $(){s.photo||(o.photo="")}async function F(){if(!(!r.currentUser||!p.params.uid))try{console.log("=== AGREGANDO AMIGO DESDE PROFILE ==="),console.log("Usuario actual:",r.currentUser.uid),console.log("Usuario objetivo:",p.params.uid);const i=r.currentUser.uid,e=p.params.uid,a=w(f(l,"friendships"),d("userId","==",i),d("friendId","==",e)),h=w(f(l,"friendships"),d("userId","==",e),d("friendId","==",i)),[u,K]=await Promise.all([S(a),S(h)]);if(!u.empty||!K.empty){console.log("Ya son amigos"),U.fire({icon:"warning",title:"Ya son amigos",text:"No puedes enviar una solicitud a alguien que ya es tu amigo",confirmButtonText:"OK"});return}const M=w(f(l,"friend_requests"),d("fromUserId","==",i),d("toUserId","==",e),d("status","==","pending"));if(!(await S(M)).empty){console.log("Ya existe una solicitud pendiente"),U.fire({icon:"warning",title:"Solicitud ya enviada",text:"Ya has enviado una solicitud de amistad a este usuario",confirmButtonText:"OK"});return}const E=await C(I(l,"users",i)),v=E.exists()?E.data():{};await A(f(l,"friend_requests"),{fromUserId:i,toUserId:e,fromUserName:v.name||"Usuario",fromUserEmail:r.currentUser.email||"",fromUserPhoto:v.photo||"",status:"pending",createdAt:B(),message:`${v.name||"Usuario"} te envió una solicitud de amistad`}),await A(f(l,"notifications"),{toUserId:e,fromUserId:i,type:"friend_request",title:"Nueva solicitud de amistad",message:`${v.name||"Usuario"} te envió una solicitud de amistad`,read:!1,createdAt:B()}),console.log("Solicitud enviada correctamente desde Profile"),U.fire({icon:"success",title:"Solicitud enviada",text:"Se ha enviado la solicitud de amistad",showConfirmButton:!1,timer:2e3})}catch(i){console.error("Error enviando solicitud desde Profile:",i),U.fire({icon:"error",title:"Error",text:"No se pudo enviar la solicitud",confirmButtonText:"OK"})}}return(i,e)=>(c(),m("section",L,[t("div",H,[t("div",W,[t("div",X,[t("div",Z,[t("div",ee,[t("div",te,[t("img",{src:o.photo?o.photo:`https://ui-avatars.com/api/?name=${encodeURIComponent(o.name||"U")}&size=150`,alt:`Foto de ${o.name}`,class:"profile-photo",onError:V},null,40,se),t("div",oe,[n.value?b((c(),m("input",{key:0,class:"input url-input",type:"url","onUpdate:modelValue":e[0]||(e[0]=a=>s.photo=a),placeholder:"Pega la URL de tu foto de perfil",onInput:T},null,544)),[[_,s.photo]]):y("",!0)])]),t("h2",ie,k(o.name),1),g.value?y("",!0):(c(),m("button",{key:0,class:"button is-success mt-2",onClick:F}," Agregar como amigo "))]),t("form",{onSubmit:Q(R,["prevent"])},[t("div",ae,[t("div",ne,[t("div",re,[e[5]||(e[5]=t("label",{class:"label"},"Nombre",-1)),t("div",le,[b(t("input",{class:"input",type:"text","onUpdate:modelValue":e[1]||(e[1]=a=>s.name=a),disabled:!n.value,required:"",onInput:$},null,40,de),[[_,s.name]])])])]),t("div",ue,[t("div",ce,[e[6]||(e[6]=t("label",{class:"label"},"Correo electrónico",-1)),t("div",me,[b(t("input",{class:"input",type:"email","onUpdate:modelValue":e[2]||(e[2]=a=>s.email=a),disabled:!n.value,required:""},null,8,pe),[[_,s.email]])])])]),t("div",fe,[t("div",he,[e[7]||(e[7]=t("label",{class:"label"},"Biografía",-1)),t("div",ve,[b(t("textarea",{class:"textarea","onUpdate:modelValue":e[3]||(e[3]=a=>s.bio=a),disabled:!n.value,rows:"3",maxlength:"180"},null,8,be),[[_,s.bio]])]),t("p",_e,k(s.bio.length)+"/180 ",1)])])]),t("div",Ue,[n.value?(c(),m("button",ge,e[9]||(e[9]=[t("i",{class:"bx bx-save mr-1"},null,-1),q("Guardar ")]))):(c(),m("button",{key:0,type:"button",class:"button is-primary is-medium",onClick:e[4]||(e[4]=a=>n.value=!0)},e[8]||(e[8]=[t("i",{class:"bx bx-edit mr-1"},null,-1),q("Editar ")]))),n.value?(c(),m("button",{key:2,type:"button",class:"button is-light is-medium",onClick:O}," Cancelar ")):y("",!0)])],32)])])])])]))}},qe=J(xe,[["__scopeId","data-v-a4f4fbfe"]]);export{qe as default};

import{r as v,a as O,w as W,J as j,n as M,N as ie,j as r,v as c,x as re,y as e,I as l,E as _,K as z,A as b,O as B,F as S,G as U,B as T,C as p,L as ce}from"./vendor-a1a62974.js";import{a as de,d as g}from"./index-912f96f0.js";import{p as ue,q as N,K as J,M as q,x as P,O as K,P as me}from"./firebase-1b009ed5.js";import{C as pe}from"./auto-69f04699.js";import{b as $,c as ve}from"./alert-015a1aea.js";import{F as be}from"./FloatingIcons-e36b23d3.js";import{_ as ge}from"./_plugin-vue_export-helper-c27b6911.js";import"./sweetalert2.esm.all-9d2ad45a.js";const _e={class:"wallet-page"},he={class:"container"},fe={class:"financial-summary mb-4"},xe={class:"columns"},ye={class:"column is-4"},Ce={class:"balance-card"},we={class:"balance-info"},ke={class:"balance-amount"},Me={class:"column is-4"},Te={class:"income-card"},Ne={class:"income-info"},Fe={class:"income-amount"},De={class:"column is-4"},Ee={class:"expense-card"},Ie={class:"expense-info"},$e={class:"expense-amount"},Ve={class:"wallet-controls mb-4"},Ye={class:"is-flex is-justify-content-space-between is-align-items-center"},Be={class:"is-flex is-align-items-center gap-3"},Se={class:"is-flex is-align-items-center gap-2"},Ue={class:"columns"},Pe={class:"column is-8"},Ae={class:"card"},Ge={class:"card-header"},Le={class:"title is-5 mb-0"},Oe={class:"card-content"},We={class:"transactions-list"},je=["id"],ze={class:"transaction-icon"},Je={class:"transaction-info"},qe={class:"transaction-title"},Ke={class:"transaction-category"},Re={class:"transaction-date"},Qe={class:"transaction-amount"},He={class:"transaction-actions"},Xe=["onClick"],Ze=["onClick"],et={class:"column is-4"},tt={class:"card mb-4"},st={class:"card-header"},at={class:"title is-5 mb-0"},nt={class:"card-content"},ot={class:"budget-categories"},lt={class:"category-header"},it={class:"category-name"},rt={class:"category-amount"},ct={class:"progress-bar"},dt={class:"card"},ut={class:"card-content chart-content"},mt={class:"expense-chart"},pt={class:"modal-card"},vt={class:"modal-card-head"},bt={class:"modal-card-title"},gt={class:"modal-card-body"},_t={class:"field"},ht={class:"control"},ft={class:"select is-fullwidth"},xt={class:"field"},yt={class:"control"},Ct={class:"field"},wt={class:"control"},kt={class:"select is-fullwidth"},Mt={key:0,value:"salary"},Tt={key:1,value:"freelance"},Nt={key:2,value:"investment"},Ft={key:3,value:"food"},Dt={key:4,value:"transport"},Et={key:5,value:"entertainment"},It={key:6,value:"health"},$t={key:7,value:"shopping"},Vt={key:8,value:"bills"},Yt={class:"field"},Bt={class:"control"},St={class:"field"},Ut={class:"control"},Pt={class:"field"},At={class:"control"},Gt={class:"modal-card-foot buttons"},Lt={class:"modal-card"},Ot={class:"modal-card-head"},Wt={class:"modal-card-body"},jt={class:"label"},zt={class:"control"},Jt=["onUpdate:modelValue"],qt={class:"modal-card-foot buttons"},Kt={__name:"Wallet",setup(Rt){const h=v(!1),f=v(!1),y=v(null),C=v("current"),V=v(null),u=O({balance:0,balanceChange:0,income:0,expenses:0}),n=O({type:"expense",title:"",category:"",amount:"",date:"",notes:""}),F=v([]),D=()=>{var a;return(a=de.currentUser)==null?void 0:a.uid};W(C,()=>{E(),M(()=>I())}),j(()=>{ue(N(g,"transactions"),a=>{const t=D();if(!t)return;const o=a.docs.map(d=>({id:d.id,...d.data()})).filter(d=>d.userId===t);F.value=o,E(),M(()=>I())})});const m=v([{name:"Comida",limit:0,spent:0},{name:"Transporte",limit:0,spent:0},{name:"Entretenimiento",limit:0,spent:0},{name:"Salud",limit:0,spent:0},{name:"Compras",limit:0,spent:0},{name:"Facturas",limit:0,spent:0}]);j(async()=>{const a=D();if(!a)return;const t=await J(N(g,"budgets"));if(!t.empty){const s=t.docs.find(o=>o.data().userId===a);if(s){const o=s.data();m.value.forEach(d=>{o[d.name]&&(d.limit=o[d.name])})}}E(),M(()=>I())});const R=async()=>{const a=D();if(!a)return;const t={};m.value.forEach(s=>t[s.name]=Number(s.limit));try{const o=(await J(N(g,"budgets"))).docs.find(d=>d.data().userId===a);o?await q(P(g,"budgets",o.id),{...t,userId:a}):await K(N(g,"budgets"),{...t,userId:a}),f.value=!1,$("Presupuesto guardado exitosamente")}catch(s){console.error("Error al guardar presupuesto:",s),alertError("Error al guardar el presupuesto")}},Q=async()=>{const a=D();a&&(!n.title.trim()||!n.amount||!n.date||(y.value?(await q(P(g,"transactions",y.value.id),{...n,amount:Number(n.amount),userId:a}),$("editado exitosamente")):(await K(N(g,"transactions"),{...n,amount:Number(n.amount),userId:a}),$("guardado exitosamente")),setTimeout(()=>{E(),M(()=>I())},100),Z(),h.value=!1))},H=async a=>{(await ve("¿deseas eliminar la transaccion?")).isConfirmed&&(await me(P(g,"transactions",a)),$("eliminado exitosamente"))},X=a=>{y.value=a,Object.assign(n,a),h.value=!0},Z=()=>{Object.assign(n,{type:"expense",title:"",category:"",amount:"",date:"",notes:""}),y.value=null};function E(){const a=new Date;let t,s;switch(C.value){case"current":t=a.getMonth(),s=a.getFullYear();break;case"previous":t=a.getMonth()-1,s=a.getFullYear(),t<0&&(t=11,s--);break;case"next":t=a.getMonth()+1,s=a.getFullYear(),t>11&&(t=0,s++);break;default:t=a.getMonth(),s=a.getFullYear()}let o=0,d=0;m.value.forEach(i=>i.spent=0),F.value.forEach(i=>{const w=new Date(i.date);if(w.getMonth()===t&&w.getFullYear()===s&&(i.type==="income"&&(o+=Number(i.amount)),i.type==="expense")){d+=Number(i.amount);const k=ee(i.category);console.log("Transaction category:",i.category,"Mapped to:",k);const x=m.value.find(le=>le.name===k);x?(x.spent+=Number(i.amount),console.log("Added to category:",x.name,"New spent:",x.spent)):console.log("Category not found:",k)}}),u.income=o,u.expenses=d,u.balance=o-d;let G=0,L=0;F.value.forEach(i=>{const w=new Date(i.date),k=t===0?11:t-1,x=t===0?s-1:s;w.getMonth()===k&&w.getFullYear()===x&&(i.type==="income"&&(G+=Number(i.amount)),i.type==="expense"&&(L+=Number(i.amount)))}),u.balanceChange=o-d-(G-L)}function ee(a){switch(a){case"food":return"Comida";case"transport":return"Transporte";case"entertainment":return"Entretenimiento";case"health":return"Salud";case"shopping":return"Compras";case"bills":return"Facturas";default:return a.toLowerCase()}}function A(){const a=new Date;let t,s;switch(C.value){case"current":t=a.getMonth(),s=a.getFullYear();break;case"previous":t=a.getMonth()-1,s=a.getFullYear(),t<0&&(t=11,s--);break;case"next":t=a.getMonth()+1,s=a.getFullYear(),t>11&&(t=0,s++);break;default:t=a.getMonth(),s=a.getFullYear()}return`${["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"][t]} ${s}`}let Y=null;function I(){if(!V.value)return;Y&&Y.destroy();const a=m.value.map(o=>o.spent),t=m.value.map(o=>o.name);console.log("Chart data:",a),console.log("Chart labels:",t),console.log("Budget categories:",m.value);const s=V.value.getContext("2d");Y=new pe(s,{type:"doughnut",data:{labels:t,datasets:[{data:a,backgroundColor:["#6366f1","#06d6a0","#fbbf24","#ef4444","#8b5cf6","#10b981"]}]},options:{plugins:{legend:{position:"bottom",labels:{usePointStyle:!0,padding:20}}},cutout:"60%",responsive:!0,maintainAspectRatio:!1}})}const te=a=>`bx ${{salary:"bx-money",freelance:"bx-briefcase",investment:"bx-trending-up",food:"bx-restaurant",transport:"bx-car",entertainment:"bx-movie",health:"bx-plus-medical",shopping:"bx-shopping-bag",bills:"bx-receipt"}[a]||"bx-dollar"}`,se=(a,t)=>{const s=a/t*100;return s>=90?"danger":s>=75?"warning":"success"},ae=(a,t)=>Math.min(a/t*100,100),ne=ie(),oe=v(null);return W(()=>ne.query.highlight,async a=>{if(a){oe.value=a,await M();const t=document.getElementById("transaction-"+a);t&&(t.classList.add("highlighted-search"),setTimeout(()=>{t.classList.remove("highlighted-search")},2e3))}},{immediate:!0}),(a,t)=>(r(),c("div",_e,[re(be,{viewType:"wallet"}),e("div",he,[t[28]||(t[28]=e("div",{class:"page-header"},[e("h1",{class:"title is-2 text-primary"},"Wallet"),e("p",{class:"subtitle is-6 text-secondary"}," Gestiona tus ingresos y gastos mensuales ")],-1)),e("div",fe,[e("div",xe,[e("div",ye,[e("div",Ce,[t[15]||(t[15]=e("div",{class:"balance-icon"},[e("i",{class:"bx bx-wallet"})],-1)),e("div",we,[t[14]||(t[14]=e("div",{class:"balance-label"},"Balance Actual",-1)),e("div",ke,"$"+l(u.balance),1),e("div",{class:_(["balance-change",u.balanceChange>=0?"positive":"negative"])},l(u.balanceChange>=0?"+":"")+"$"+l(u.balanceChange)+" este mes ",3)])])]),e("div",Me,[e("div",Te,[t[18]||(t[18]=e("div",{class:"income-icon"},[e("i",{class:"bx bx-trending-up"})],-1)),e("div",Ne,[t[16]||(t[16]=e("div",{class:"income-label"},"Ingresos",-1)),e("div",Fe,"$"+l(u.income),1),t[17]||(t[17]=e("div",{class:"income-period"},"Este mes",-1))])])]),e("div",De,[e("div",Ee,[t[21]||(t[21]=e("div",{class:"expense-icon"},[e("i",{class:"bx bx-trending-down"})],-1)),e("div",Ie,[t[19]||(t[19]=e("div",{class:"expense-label"},"Gastos",-1)),e("div",$e,"$"+l(u.expenses),1),t[20]||(t[20]=e("div",{class:"expense-period"},"Este mes",-1))])])])])]),e("div",Ve,[e("div",Ye,[e("div",Be,[e("button",{class:"btn btn-accent",onClick:t[0]||(t[0]=s=>h.value=!0)},t[22]||(t[22]=[e("i",{class:"bx bx-plus mr-2"},null,-1),z("Nueva Transacción ")])),e("button",{class:"btn btn-primary",onClick:t[1]||(t[1]=s=>f.value=!0)},t[23]||(t[23]=[e("i",{class:"bx bx-target-lock mr-2"},null,-1),z("Configurar Presupuesto ")]))]),e("div",Se,[b(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>C.value=s),class:"select select-month"},t[24]||(t[24]=[e("option",{value:"current"},"Mes Actual",-1),e("option",{value:"previous"},"Mes Anterior",-1),e("option",{value:"next"},"Próximo Mes",-1)]),512),[[B,C.value]])])])]),e("div",Ue,[e("div",Pe,[e("div",Ae,[e("div",Ge,[e("h3",Le," Transacciones - "+l(A()),1)]),e("div",Oe,[e("div",We,[(r(!0),c(S,null,U(F.value,s=>(r(),c("div",{key:s.id,id:"transaction-"+s.id,class:_(["transaction-item",s.type])},[e("div",ze,[e("i",{class:_(te(s.category))},null,2)]),e("div",Je,[e("div",qe,l(s.title),1),e("div",Ke,l(s.category),1),e("div",Re,l(s.date),1)]),e("div",Qe,[e("span",{class:_(s.type==="income"?"text-accent":"text-warning")},l(s.type==="income"?"+":"-")+"$"+l(s.amount),3)]),e("div",He,[e("button",{class:"btn-icon",onClick:o=>X(s)},t[25]||(t[25]=[e("i",{class:"bx bx-edit"},null,-1)]),8,Xe),e("button",{class:"btn-icon",onClick:o=>H(s.id)},t[26]||(t[26]=[e("i",{class:"bx bx-trash"},null,-1)]),8,Ze)])],10,je))),128))])])])]),e("div",et,[e("div",tt,[e("div",st,[e("h3",at," Presupuesto - "+l(A()),1)]),e("div",nt,[e("div",ot,[(r(!0),c(S,null,U(m.value,s=>(r(),c("div",{key:s.name,class:"budget-category"},[e("div",lt,[e("span",it,l(s.name),1),e("span",rt,"$"+l(s.spent)+" / $"+l(s.limit),1)]),e("div",ct,[e("div",{class:_(["progress-fill",se(s.spent,s.limit)]),style:ce({width:ae(s.spent,s.limit)+"%"})},null,6)])]))),128))])])]),e("div",dt,[t[27]||(t[27]=e("div",{class:"card-header"},[e("h3",{class:"title is-5 mb-0"},"Distribución de Gastos")],-1)),e("div",ut,[e("div",mt,[e("canvas",{ref_key:"expenseChart",ref:V,width:"300",height:"200"},null,512)])])])])])]),e("div",{class:_(["modal",{"is-active":h.value}])},[e("div",{class:"modal-background",onClick:t[3]||(t[3]=s=>h.value=!1)}),e("div",pt,[e("header",vt,[e("p",bt,l(y.value?"Editar Transacción":"Nueva Transacción"),1)]),e("section",gt,[e("div",_t,[t[30]||(t[30]=e("label",{class:"label"},"Tipo",-1)),e("div",ht,[e("div",ft,[b(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>n.type=s)},t[29]||(t[29]=[e("option",{value:"income"},"Ingreso",-1),e("option",{value:"expense"},"Gasto",-1)]),512),[[B,n.type]])])])]),e("div",xt,[t[31]||(t[31]=e("label",{class:"label"},"Título",-1)),e("div",yt,[b(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>n.title=s),class:"input",type:"text",placeholder:"Descripción de la transacción"},null,512),[[T,n.title]])])]),e("div",Ct,[t[32]||(t[32]=e("label",{class:"label"},"Categoría",-1)),e("div",wt,[e("div",kt,[b(e("select",{"onUpdate:modelValue":t[6]||(t[6]=s=>n.category=s)},[n.type==="income"?(r(),c("option",Mt," Salario ")):p("",!0),n.type==="income"?(r(),c("option",Tt," Freelance ")):p("",!0),n.type==="income"?(r(),c("option",Nt," Inversión ")):p("",!0),n.type==="expense"?(r(),c("option",Ft," Comida ")):p("",!0),n.type==="expense"?(r(),c("option",Dt," Transporte ")):p("",!0),n.type==="expense"?(r(),c("option",Et," Entretenimiento ")):p("",!0),n.type==="expense"?(r(),c("option",It," Salud ")):p("",!0),n.type==="expense"?(r(),c("option",$t," Compras ")):p("",!0),n.type==="expense"?(r(),c("option",Vt," Facturas ")):p("",!0)],512),[[B,n.category]])])])]),e("div",Yt,[t[33]||(t[33]=e("label",{class:"label"},"Monto",-1)),e("div",Bt,[b(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>n.amount=s),class:"input",type:"number",step:"0.01",placeholder:"0.00"},null,512),[[T,n.amount]])])]),e("div",St,[t[34]||(t[34]=e("label",{class:"label"},"Fecha",-1)),e("div",Ut,[b(e("input",{"onUpdate:modelValue":t[8]||(t[8]=s=>n.date=s),class:"input",type:"date"},null,512),[[T,n.date]])])]),e("div",Pt,[t[35]||(t[35]=e("label",{class:"label"},"Notas (opcional)",-1)),e("div",At,[b(e("textarea",{"onUpdate:modelValue":t[9]||(t[9]=s=>n.notes=s),class:"textarea",placeholder:"Notas adicionales"},null,512),[[T,n.notes]])])])]),e("footer",Gt,[e("button",{class:"btn btn-primary",onClick:Q}," Guardar "),e("button",{class:"btn button is-danger has-text-white-bis",onClick:t[10]||(t[10]=s=>h.value=!1)}," Cancelar ")])])],2),e("div",{class:_(["modal",{"is-active":f.value}])},[e("div",{class:"modal-background",onClick:t[11]||(t[11]=s=>f.value=!1)}),e("div",Lt,[e("header",Ot,[t[36]||(t[36]=e("p",{class:"modal-card-title"},"Configurar Presupuesto",-1)),e("button",{class:"delete",onClick:t[12]||(t[12]=s=>f.value=!1)})]),e("section",Wt,[(r(!0),c(S,null,U(m.value,s=>(r(),c("div",{key:s.name,class:"field"},[e("label",jt,l(s.name),1),e("div",zt,[b(e("input",{"onUpdate:modelValue":o=>s.limit=o,class:"input",type:"number",step:"0.01",placeholder:"0.00"},null,8,Jt),[[T,s.limit]])])]))),128))]),e("footer",qt,[e("button",{class:"btn btn-primary",onClick:R},"Guardar"),e("button",{class:"btn button is-danger has-text-white-bis",onClick:t[13]||(t[13]=s=>f.value=!1)}," Cancelar ")])])],2)]))}},ns=ge(Kt,[["__scopeId","data-v-49a55631"]]);export{ns as default};
